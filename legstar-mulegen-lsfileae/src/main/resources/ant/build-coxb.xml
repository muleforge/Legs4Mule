<!-- =================================================================================
     This script generates binding classes from JAXB objects. A set of cobol binding
     classes is generated, to provide efficient runtime code for visitors (avoids
     reflection and use of annotations at runtime).
  -->
<project basedir=".." default="compileCOXB" name="generate-COXB-classes">

    <!-- ===========================================================  -->
    <!-- Setup environment
    -->
    <target name="init">
    
        <property environment="env"/>
        <!-- LegStar location -->
        <property name="legstar.home" value="${env.LEGSTAR_HOME}" />

        <!-- Path to the source XML schema file   -->
        <property name="xsd.file" value="schema/lsfileae.xsd" />
        <!-- Location for generated classes   -->
        <property name="jaxb.src.dir" value="src" />
        <!-- Location for generated JAXB binaries   -->
        <property name="jaxb.bin.dir" value="build" />
        <!-- The JAXB root object name. Binding is for a single complex
         element.   -->
        <property name="jaxb.root.name" value="Dfhcommarea" />
        
        <!-- Classpath setting -->
        <path id="classpath">
            <pathelement location="${basedir}"/>
            <fileset dir="${legstar.home}" includes="lib/*.jar" />
            <!--JAXB generated classes (needed for reflection) -->
            <dirset dir="${jaxb.bin.dir}"/>
        </path>
        
        <!-- COBOL Binding Generator ant task -->
        <taskdef name="coxbgen"
            classname="com.legstar.coxb.gen.CoxbBindingGenerator"
            classpathref="classpath"/>
    
    </target>

    <!-- ===========================================================  -->
    <!-- Generate binding classes by reflecting on JAXB classes.
    -->
    <target name="generateCOXB" depends="init">
        <echo message="Generating binding classes for ${xsd.file}" />
        <coxbgen 
            XsdFile="${xsd.file}"
            JaxbRootObjectName="${jaxb.root.name}"
            targetDir="${jaxb.src.dir}"
        />
    </target>

    <!-- ===========================================================  -->
    <!-- Compile the generated binding classes
    -->
    <target name="compileCOXB" depends="generateCOXB">
        <javac target="1.5"
            srcdir="${jaxb.src.dir}"
            destdir="${jaxb.bin.dir}"
            classpathref="classpath"
            fork="yes"
		        includes="com/legstar/test/coxb/**"
        />
    </target>
  
</project>
