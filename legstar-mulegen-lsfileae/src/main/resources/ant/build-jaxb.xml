<!-- =================================================================================
     This script generates JAXB classes from an XML Schema. A plugin to the
     standard sun XJC tool uses annotations in the XSD to annotate the JAXB
     classes.
  -->
<project basedir=".." default="compileJAXB" name="generate-JAXB-classes">

    <!-- ===========================================================  -->
    <!-- Setup environment
    -->
    <target name="init">
    
        <property environment="env"/>
        <!-- LegStar location -->
        <property name="legstar.home" value="${env.LEGSTAR_HOME}" />
        <!-- Path to the source XML schema file   -->
        <property name="xsd.file" value="schema/lsfileae.xsd" />
        <!-- Location of external bindings files   -->
        <property name="bindings.dir" value="${legstar.home}/xjb" />
        <!-- Location for generated JAXB classes   -->
        <property name="jaxb.src.dir" value="src" />
        <!-- Location for generated JAXB binaries   -->
        <property name="jaxb.bin.dir" value="build" />
        <!-- Whether to fork the java compiler or not   -->
        <property name="javac.fork" value="no" />
      
        <!-- Classpath setting  -->
        <path id="classpath">
            <pathelement location="${basedir}"/>
            <fileset dir="${legstar.home}" includes="lib/*.jar" />
        </path>

        <!-- The regular sun JAXB XJC tool ant task  -->
        <taskdef name="xjc" classname="com.sun.tools.xjc.XJC2Task" classpathref="classpath"/>
    
        <!-- Make sure target directories exist -->
        <mkdir dir="${jaxb.src.dir}"/>
        <mkdir dir="${jaxb.bin.dir}"/>
    
    </target>

    <!-- ===========================================================  -->
    <!-- Generate the JAXB classes source
    -->
    <target name="generateJAXB" depends="init">
        <echo message="Generating JAXB classes for ${xsd.file}" />
        <xjc schema="${xsd.file}" destdir="${jaxb.src.dir}" extension="true" removeOldOutput="yes">
            <!--COXB xjc plugin extension-->
            <arg value="-Xlegstar-code" />
            <!--Without this option (no validation), out of memory errors -->
            <arg value="-nv" />
            <!-- External XJC bindings directory. Collects all *.xjb files -->
            <arg value="-b" />
            <arg value="${bindings.dir}" />
        </xjc>
    </target>

    <!-- ===========================================================  -->
    <!-- Compile the generated JAXB classes. fork="no" prevents
        the bug on package-info.java
    -->
    <target name="compileJAXB" depends="generateJAXB">
        <javac target="1.5"
            srcdir="${jaxb.src.dir}"
            destdir="${jaxb.bin.dir}"
            classpathref="classpath"
            fork="${javac.fork}"
            includes="com/legstar/test/coxb/**"
        />
    </target>
  
</project>
