h1. QuickStart ESB adapter for a CICS program using Eclipse plugins.

h2. QuickStart description

This is an alternative to [MuleLegStarAdapterQuickStartAnt] using Eclipse plugins rather than ant scripts.

Using Eclipse plugins, we will walk you through the process of integrating Mule with a backend IBM CICS system

Once deployed, the generated ESB component will act as an adapter for the sample CICS COBOL program LSFILEAE. ESB clients can then consume the ESB component without any knowledge of the actual legacy backend system:

!Legs4Mule-quickstart-adapter.png!

h2. Installation

Follow instructions in:[InstallationInstructions].

The installed z/OS CICS modules include the LSFILEAE COBOL sample program that we will be using for this quickstart.

We will be using HTTP connectivity to CICS for this quickstart (Alternatively, you can use Sockets or Websphere MQ).

Start Eclipse and select menu option Help\-\->Software Updates\-\->Find and Install...

From there check the *Search for new features to install* option and click next. 

Create a *New Remote Site* named legstar-mule and have the URL point to: http://dist.muleforge.org/legstar-transport//eclipse/update
 
With this new site selected, when you press the finish button, you are presented with all the plugins you need. Select the entire LegStar group, click next, accept the license terms and then click finish which should end the installation process.
 
h2. Generate a Mule component adapter for a mainframe program

Start by creating a new Java project called MuleLsfileae and select the project.

h3. Map the LSFILEAE Structures to XML Schema

First step is to generate an XML schema from the source of the target COBOL program LSFILEAE.

Select the Structures Mapping plugin:

!EclipseToolBarSelectStructuresMapping.png!

Then type the name of the target XML Schema, lsfileae.xsd, in the *XSD file name" field. This should pre-fill the other fields:

!EclipseStructuresMappingPage1.png!

Click next and click on the *Select Cobol fragments from file system* link. This will pop up a standard file selection dialog. Look for your LegStar installation folder. Under the samples/mule/quickstarts/legstar_adapter/cobol sub-folder, you will find the lsfileae.cbl sample. When you select that file, the content is displayed for your review:

!EclipseStructuresMappingPage2.png!

Although the entire COBOL program is displayed, only the data description will be processed.

Click on the Finish button, this starts the mapping process and the generated XML Schema is opened. You will notice that each COBOL data structure in the LSFILEAE COBOL source has been mapped to an XML Schema type.

h3. Bind the XML Schema to Java annotated classes

Next step turns the XML schema types into Java annotated classes.

From the package explorer view, expand your Java project. The generated lsfileae.xsd file should appear. Select the file, right click to show the context menu and then select !LegStar-->Generate Binding classes:

!EclipseContextMenuSelectBinding.png!

Lsfileae.xsd contains 2 complex types: Dfhcommarea and ComPersonal which is a sub-type of Dfhcommarea. Binding a type will automatically bind all sub-types so all we have to do is to select Dfhcommarea and click Finish:

!EclipseBindingPage1.png!

Your package explorer should now display 2 new packages. A library containing the LegStar dependencies should have been added to the project Build path.

If you open Dfhcommarea.java, you will notice that classes exhibit annotations that bind java types both to XML and COBOL:

!EclipseBindingResults.png!

h3. Generate an ESB component adapter for LSFILEAE

The last step generates the lsfileaeBridgeUMO Mule component.

With your MuleLsfileae project selected, select the Operations mapping plugin:

!EclipseToolBarSelectOperationsMapping.png!

Enter name lsfileae.cixs for the operations mapping file.

!EclipseOperationsMappingPage1.png!

After you click finish, use the Add... button to create a new operation. Ultimately, this operation will become a UMO in the ESB pipeline.

Type in operation name lsfileae:

!EclipseOperationsMappingPage2.png!

An operation maps to a mainframe program in a request/response exchange pattern.

What you need to do at this stage is specify the input and output structures. You select these structures from the set that was bound during the previous step. These are displayed when you click on the Add button, successively for Input and for Output:

!EclipseOperationsMappingPage3.png!

In our case, we select Dfhcommarea both for Input and for Output, because the LSFILEAE program uses a single structure both for input and output:

!EclipseOperationsMappingPage4.png!

After you click on ok, the Generate button is now enabled. If you click on it, you should be able to select the Mule adapter target:

!EclipseMuleAdapterGenerationSelect.png!

Clicking on ok again will get you to a multi-tab dialog showing pre-filled generation options:

!EclipseMuleAdapterGenerationPage1.png!

You don't normally need to change any of these options so you should click on Finish which will generate the Mule adapter: 

!EclipseMuleAdapterGenerationPage2.png!

Under src/com/legstar/test/cixs/mule/lsfileae you will find the generated LsfileaeCallable.java source of the actual Mule component.

Under conf, Mule configuration samples are generated:

 * mule-adapter-bridge-config-lsfileae.xml

 Is the Mule configuration file. Notice that generated transformers are referenced. These transformers turn mainframe data to java objects.Access to mainframe uses the Mule Legstar transport which is based on HTTP.

 * mule-adapter-standalone-config-lsfileae.xml
 
 Is an alternative to the previous configuration that you can use with the associated legstar-invoker-config.xml, if you need Socket or WebSphere MQ access to the mainframe.

The ant folder contains the build.xml generated ant script which bundles the mule-legstar-lsfileae.jar file and deploys the generated component to your Mule installation (Defined by the MULE_HOME environment variable).

h3. Test the ESB component adapter

The legstar-mule installation src/org/mule/providers/legstar/test/lsfileae folder contains a LsfileaeBridgeTest.java program that you can use to invoke the newly deployed component.

LsfileaeBridgeTest is a JUnit test using the Mule unit test framework so you don't need to actually deploy the component in order to run the test.
